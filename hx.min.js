/* ------------------------------------- */
/*         jQuery.hx v0.2 (beta)         */
/* ------------------------------------- */

(function(e){var t={debug:false};var n=function(t){this.element=t;this.props={};this.transform=[];this.queue=[];this.listening=false;this._callback=function(){};this.configKeys=["property","value","duration","easing","delay","done"];this.calculatedKeys=["width","height"];this.nonTransformKeys=["opacity"];var n=e(this.element);n.hxManager=1;e.extend(n,this);return n};n.prototype={_get:function(){var e=window.getComputedStyle(this.element).webkitTransform;if(e!=="none"){this.transform.push(e)}},_getTransformType:function(e){var t=[];var n=[];for(var r in e){if(this.configKeys.indexOf(r)<0){if(this.calculatedKeys.indexOf(r)>=0){n.push(r)}else{t.push(r)}}if(t.length>0&&n.length>0)throw"Error: Incompatible transform properties."}return n.length>0?"calc":"raw"},handleEvent:function(e){this._transend(e)},setOrigin:function(t,n){t=t&&typeof t!=="undefined"?t:50;n=n&&typeof n!=="undefined"?n:50;e(this.element).css({"-webkit-transform-origin":t+"% "+n+"%"});this.transformOrigin={x:t,y:n}},_calcWidthScale:function(e){return e/this.element.getBoundingClientRect().width},_calcHeightScale:function(e){return e/this.element.getBoundingClientRect().height},_getFixedOrigin:function(t){var n=e.extend({},window.getComputedStyle(this.element));var r=this.element.getBoundingClientRect();n.width=parseInt(n.width,10);n.height=parseInt(n.height,10);var i=(r.width-n.width)*t[0]/2;var s=(r.height-n.height)*t[1]/2;var o=(r.width*t[0]-n.width)/2-i;var u=(r.height*t[1]-n.height)/2-s;return[o,u]},apply:function(e,t){this._get();return this.set(e,t)},set:function(n,r){var i=this;if(this.queue.indexOf(n)<0)this.queue.push(n);if(t.debug)console.log(this.queue);var s={};if(this._getTransformType(r)==="raw"){s=this._getRawComponents(r)}else{s=this._getCalculatedComponents(r)}if(t.debug)console.log(s);var o={value:this.nonTransformKeys.indexOf(n)<0?this._buildTransformString(s):s[n][0],duration:r.duration?r.duration+"ms":"400ms",easing:r.easing||"cubic-bezier(0.25,0.1,0.25,1)",delay:r.delay||1,done:r.done||[]};this.props[n]=o;if(t.debug)console.log(this.props);var u=this._buildTransitionString();if(t.debug)console.log(u);e(this.element).css("-webkit-transition",u);if(!this.listening){this.element.addEventListener("webkitTransitionEnd",this);this.listening=true}setTimeout(function(){e(i.element).css(n,o.value)},this.props[n].delay);return this},_getRawComponents:function(t){var n=[];var r={};for(var i in t){if(this.configKeys.indexOf(i)>=0)continue;var s=Array.isArray(t[i])?t[i]:[t[i]];switch(i){case"translate3d":n=[0,0,0];break;case"scale3d":n=[1,1,1];break;case"rotate3d":n=[0,0,0,0];break;case"rotateX":case"rotateY":case"rotateZ":case"opacity":n=[0];break}s=e.extend(n,s);r[i]=s}return r},_getCalculatedComponents:function(e){var t=[];var n={};for(var r in e){if(this.configKeys.indexOf(r)>=0)continue;switch(r){case"width":var i=this._calcWidthScale(e[r]);n.translate3d=n.translate3d||[0,0,0];n.scale3d=n.scale3d||[1,1,1];n.translate3d[0]=n.translate3d[0]+this._getFixedOrigin([i,1])[0];n.scale3d[0]=n.scale3d[0]*i;break;case"height":var s=this._calcHeightScale(e[r]);n.translate3d=n.translate3d||[0,0,0];n.scale3d=n.scale3d||[1,1,1];n.translate3d[1]=n.translate3d[1]+this._getFixedOrigin([1,s])[1];n.scale3d[1]=n.scale3d[1]*s;break}}return n},_buildComponentString:function(e,t){var n="";var r="";switch(e){case"translate3d":n="px, ";r="px";break;case"scale3d":n=", ";r="";break;case"rotate3d":n=", ";r="deg";break;case"rotateX":case"rotateY":case"rotateZ":n="";r="deg";break}return e+"("+t.join(n)+r+")"},_buildTransformString:function(e){for(var t in e){if(this.configKeys.indexOf(t)<0){var n=this._buildComponentString(t,e[t]);this.transform.push(n)}}return this.transform.join(" ")},_buildTransitionString:function(){var e=[];for(var t in this.props){var n=t+" "+this.props[t].easing+" "+this.props[t].duration;if(e.indexOf(n)<0)e.push(n)}return e.join(", ")},_transend:function(e){var t=e.propertyName;for(var n in this.props){if(t===n&&typeof this.props[n].done[0]==="function"){for(var r=0;r<this.props[n].done.length;r++){this.props[n].done[r].call(this,e)}delete this.props[n].done}}var i=this.queue.indexOf(t);this.queue.splice(i,1);if(this.queue.length<1){if(this._callback)this._callback.call(this,e);this.element.removeEventListener("webkitTransitionEnd",this);this.listening=false}},done:function(e){this._callback=e||function(){}}};e.fn.hx=function(t,r){var i=this;if(!i.hxManager)i=new n(e(this).get(0));if(t)e.fn.hx[t].call(i,r);return i};e.fn.hx.scale=function(t){t=e.extend({duration:400,easing:"ease",delay:1,vector:{},done:function(){}},t);t.done=function(){};t.vector=e.extend({x:1,y:1,z:1},t.vector);t.vector.x=t.vector.x===0?1e-6:t.vector.x;t.vector.y=t.vector.y===0?1e-6:t.vector.y;t.vector.z=t.vector.z===0?1e-6:t.vector.z;this.apply("-webkit-transform",{scale3d:[t.vector.x,t.vector.y,t.vector.z],duration:t.duration,easing:t.easing,delay:t.delay,done:[t.done]})};e.fn.hx.translate=function(t){t=e.extend({duration:400,easing:"ease",delay:1,vector:{},done:function(){}},t);t.done=function(){};t.vector=e.extend({x:0,y:0,z:0},t.vector);this.apply("-webkit-transform",{translate3d:[t.vector.x,t.vector.y,t.vector.z],duration:t.duration,easing:t.easing,delay:t.delay,done:[t.done]})};e.fn.hx.fadeOut=function(t){t=e.extend({duration:400,easing:"ease",delay:1,done:function(){}},t);t.done=function(){};e(this).css({"-webkit-transition":"",opacity:1,display:"block"});var n=function(){e(this).css({"-webkit-transition":"",opacity:1,display:"none"})};this.set("opacity",{opacity:0,duration:t.duration,easing:t.easing,delay:t.delay,done:[n,t.done]})};e.fn.hx.fadeIn=function(t){t=e.extend({duration:400,easing:"ease",delay:1,done:function(){}},t);t.done=function(){};e(this).css({"-webkit-transition":"",opacity:0,display:"block"});this.set("opacity",{opacity:1,duration:t.duration,easing:t.easing,delay:t.delay,done:[t.done]})};e.fn.hx.notify=function(t){if(e(this).find(".hx_notify").length>0)return;var n=this;this.options=e.extend({message:"",timeout:1500,css:{},onOpen:function(){},onClose:function(){}},t||{});this.dims=e(this).get(0).getBoundingClientRect();this.Top=Math.round(this.dims.height*.4);this.Left=Math.round(this.dims.width*.1);this.Width=this.dims.width-this.Left*2;this.Height=Math.round(this.Width*.15);this.fontSize=Math.round(this.Height*.3);this.radius=Math.round(this.fontSize*.8);this.options.css=e.extend({"text-align":"center","font-size":this.fontSize+"px",color:"white",position:"absolute",left:this.Left+"px",top:this.Top+"px",width:this.Width+"px",height:this.Height+"px","line-height":this.Height+"px","background-color":"rgba(0,0,0,0.8)","-webkit-border-radius":this.radius+"px","z-index":1e4,display:"none"},this.options.css);var r=document.createElement("div");e(r).addClass("hx_notify").css(this.options.css).html(this.options.message).appendTo(e(this));this.overlay=e(r);this.open=function(){this.overlay.hx("fadeIn",{duration:300}).hx("translate",{vector:{y:-this.Height},duration:300}).done(this.options.onOpen)};this.close=function(){this.overlay.hx("fadeOut",{duration:300}).hx("translate",{duration:300}).done(function(t){n.options.onClose(t);e(this.element).remove()})};this.open();if(this.options.timeout>0){setTimeout(function(){n.close()},this.options.timeout)}}})(jQuery)